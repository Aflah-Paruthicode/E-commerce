<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sales Report | DashFootwares Control</title>
  <link rel="icon" type="image/x-icon" href="/logo/DashFootwares.png">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  
  <style>
    :root {
      --sidebar-width: 260px;
      --bg-gray: #f4f7f6;
      --dark-slate: #1e293b;
      --accent-blue: #3b82f6;
    }

    body { font-family: 'Montserrat', sans-serif; background-color: var(--bg-gray); margin: 0; }

    header { background: #fff; height: 70px; display: flex; align-items: center; padding: 0 30px; position: fixed; width: 100%; top: 0; z-index: 1000; border-bottom: 1px solid #e2e8f0; justify-content: space-between; }
    .sidebar { width: var(--sidebar-width); background: var(--dark-slate); height: 100vh; position: fixed; top: 70px; left: 0; padding: 20px 10px; overflow-y: auto; }
    .nav-btn { width: 100%; border: none; background: transparent; padding: 12px 15px; border-radius: 8px; margin-bottom: 5px; display: flex; align-items: center; transition: 0.3s; text-decoration: none; }
    .nav-btn:hover { background: rgba(255,255,255,0.1); }
    .nav-btn i { color: #94a3b8; width: 25px; font-size: 18px; }
    .nav-btn span { color: #cbd5e1; font-size: 14px; font-weight: 500; margin-left: 10px; }
    .nav-btn.active { background: rgba(255, 255, 255, 0.1); }
    .nav-btn.active span, .nav-btn.active i { color: #fff; font-weight: 700; }

    .main-content { margin-left: var(--sidebar-width); margin-top: 70px; padding: 30px; }

    /* Analytics Cards */
    .report-summary { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin-bottom: 30px; }
    .stat-card { background: var(--dark-slate); color: white; padding: 25px; border-radius: 16px; position: relative; overflow: hidden; }
    .stat-card h5 { font-size: 12px; text-transform: uppercase; letter-spacing: 1px; opacity: 0.8; margin-bottom: 10px; }
    .stat-card h2 { font-weight: 800; margin: 0; font-size: 28px; }
    .stat-card i { position: absolute; right: -10px; bottom: -10px; font-size: 80px; opacity: 0.1; transform: rotate(-15deg); }

    /* Filter Tool Bar */
    .filter-bar { background: #fff; padding: 20px; border-radius: 12px; border: 1px solid #e2e8f0; margin-bottom: 25px; display: flex; flex-wrap: wrap; gap: 20px; align-items: flex-end; }
    .filter-group { display: flex; flex-direction: column; gap: 5px; }
    .filter-group label { font-size: 11px; font-weight: 700; color: #64748b; text-transform: uppercase; }
    .form-select, .form-control { border-radius: 8px; font-size: 13px; border: 1px solid #e2e8f0; height: 40px; }

    /* Table */
    .content-card { background: #fff; border-radius: 12px; border: 1px solid #e2e8f0; overflow: hidden; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); }
    .table thead th { background: #f8fafc; color: #64748b; font-size: 10px; text-transform: uppercase; letter-spacing: 0.5px; padding: 15px 10px; }
    .table tbody td { padding: 12px 10px; vertical-align: middle; color: #1e293b; font-size: 12.5px; border-bottom: 1px solid #f1f5f9; }

    .discount-text { color: #10b981; font-weight: 600; }
    .price-text { font-weight: 700; color: #0f172a; }

    .pagination .btn { border: 1px solid #e2e8f0; margin: 0 3px; font-size: 12px; }
    .pagination .btn.active { background: var(--dark-slate); color: white; border-color: var(--dark-slate); }
  </style>
</head>
<body>

  <header>
    <div class="d-flex align-items-center">
      <img src="/logo/DashFootwares.png" alt="" width="35">
      <h3 class="ms-3 mb-0" style="font-size: 16px; font-weight: 800;">DASH CONTROL</h3>
    </div>
    <div class="d-flex align-items-center gap-3">
      <span class="small fw-bold me-2">Aflah (Admin)</span>
      <form action="/admin/logout">
        <button type="submit" class="btn btn-sm btn-outline-danger fw-bold">LOGOUT</button>
      </form>
    </div>
  </header>

  <aside class="sidebar">
      <a href="/admin/dashboard" class="nav-btn"> <i class="fa-solid fa-chart-line"></i><span>Dashboard</span> </a>
      <a href="/admin/customers" class="nav-btn"> <i class="fa-solid fa-users"></i><span>Customers</span> </a>
      <a href="/admin/product" class="nav-btn"> <i class="fa-solid fa-shoe-prints"></i><span>Products</span> </a>
      <a href="/admin/orders" class="nav-btn"> <i class="fa-solid fa-bag-shopping"></i><span>Orders</span> </a>
      <a href="/admin/category" class="nav-btn"> <i class="fa-solid fa-layer-group"></i><span>Categories</span> </a>
      <a href="/admin/couponManagement" class="nav-btn"> <i class="fa-solid fa-ticket"></i><span>Coupons</span> </a>
      <a href="/admin/banner" class="nav-btn"> <i class="fa-solid fa-image"></i><span>Banners</span> </a>
      <a href="/admin/offerManagement" class="nav-btn"><i class="fa-solid fa-percent"></i><span>Offer Management</span></a>
      <a href="/admin/salesReport" class="nav-btn active"> <i class="fa-solid fa-file-invoice-dollar"></i><span>Sales Report</span> </a>
    </aside>

  <main class="main-content">   
    <h4 class="fw-bold mb-4">Sales Report</h4>

    <div class="report-summary">
        <div class="stat-card">
            <h5>Total Orders</h5>
            <h2><%= totel_orders %></h2>
            <i class="fa-solid fa-cart-shopping"></i>
        </div>
        <div class="stat-card" style="background: var(--accent-blue);">
            <h5>Total Revenue</h5>
            <h2>₹ <%= orderTotel %>.00</h2>
            <i class="fa-solid fa-indian-rupee-sign"></i>
        </div>
    </div>

    <div class="filter-bar">
        <form action="/admin/salesReport" id="reportForm" method="get" class="d-flex gap-3 align-items-end flex-grow-1">
            <div class="filter-group">
                <label>Format</label>
                <select name="format" class="form-select" onchange="submitForm()" style="width: 120px;">
                    <option value="">Export As</option>
                    <option value="pdf">PDF</option>
                    <option value="excel">Excel</option>
                </select>
            </div>
            <div class="filter-group">
                <label>Time Period</label>
                <select id="dateFilter" class="form-select" name="dura" onchange="submitFormSort(this.value)" style="width: 150px;">
                    <option value="">Quick Select</option>
                    <option value="day">Daily</option>
                    <option value="week">Weekly</option>
                    <option value="month">Monthly</option>
                    <option value="year">Yearly</option>
                </select>
            </div>
            <div class="filter-group">
                <label>Custom Date</label>
                <input type="date" id="startDate" class="form-control" style="width: 160px;">
            </div>
            <button type="button" class="btn btn-dark fw-bold px-4" style="height: 40px; border-radius: 8px;" onclick="filterForm()">
                Filter
            </button>
        </form>
    </div>

    <div class="content-card">
      <table class="table mb-0">
        <thead>
          <tr>
            <th>No</th>
            <th>Buyer</th>
            <th>Product</th>
            <th>Qty</th>
            <th>Base Price</th>
            <th>GST (10%)</th>
            <th>Discount</th>
            <th>Category</th>
            <th class="text-end">Final Total</th>
          </tr>
        </thead>
        <tbody>
          <% if(orders.length > 0 ) { %>
            <% let k = 0 %>
            <% orders.forEach((order)=> { %>
            <tr>
              <td><span class="text-muted small"><%= i+1 %></span></td>
              <td class="fw-semibold"><%= users[k].name %></td>
              <td>
                <span title="<%= products[k].name %>">
                    <%= products[k].name.slice(0,25) %>...
                </span>
              </td>
              <td><span class="badge bg-light text-dark border"><%= order.quantity %></span></td>
              <td class="price-text">₹ <%= products[k].price %></td>
              <td class="text-muted">₹ <%= (products[k].price/10).toFixed(0) %></td>
              <td>
                <% if(orders[k].coupon_applied !== 'no') { %>
                  <span class="discount-text">-₹ <%= (order.is_multi > 1 ? order.coupon_Discount / order.is_multi : order.coupon_Discount) %></span>
                <% } else { %>
                  <span class="text-muted">₹ 0.00</span>
                <% } %>
              </td>
              <td><small class="text-uppercase fw-bold text-muted"><%= products[k].category %></small></td>
              <td class="text-end fw-bold">₹ willaddit.00</td>
            </tr>
            <% k++; i++; %>
            <% }) %>
          <% } else { %>
            <tr><td colspan="9" class="text-center py-5 text-muted">No sales data found for this period.</td></tr>
          <% } %>
        </tbody>
      </table>
    </div>

    <% if (pagination.totalPages > 1) { %>
    <div class="d-flex justify-content-end mt-4">
      <nav class="pagination">
        <% if (pagination.hasPrevPage) { %>
            <a class="btn" href="?page=<%= pagination.currentPage - 1 %>&limit=<%= pagination.limit %><%= queryString %>">Prev</a>
        <% } %>
        <% for (let p = 1; p <= pagination.totalPages; p++) { %>
            <a href="?page=<%= p %>&limit=<%= pagination.limit %><%= queryString %>" class="btn <%= pagination.currentPage === p ? 'active' : '' %>"><%= p %></a>
        <% } %>
        <% if (pagination.hasNextPage) { %>
            <a class="btn" href="?page=<%= pagination.currentPage + 1 %>&limit=<%= pagination.limit %><%= queryString %>">Next</a>
        <% } %>
      </nav>
    </div>
    <% } %>
  </main>

  <script>
    function submitForm() { document.getElementById('reportForm').submit(); }
    function submitFormSort(data) { window.location.href = `/admin/salesReport/?period=${data}`; }
    function filterForm() {
      let data = document.getElementById('startDate').value;
      if(data) window.location.href = `/admin/salesReport/?period=${data}`;
    }
  </script>
</body>
</html>