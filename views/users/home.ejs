<%- include('../layouts/header.ejs') %>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.theme.default.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>
<link rel="stylesheet" href="/css/userCss/home.css" />

<div class="home-container">
  <div class="banner-carousel owl-carousel">
    <% SlideBanners.forEach((banner) => { %>
    <a href="<%= banner.url %>">
      <div class="item">
        <img src="/banners/<%= banner.image %>" alt="Banner" />
      </div>
    </a>
    <% }) %>
  </div>

  <div class="section-title-wrap">
    <h4>New Arrivals</h4>
    <a href="/viewAllBestProducts" class="view-all-link">VIEW ALL PRODUCTS</a>
  </div>

  <div class="premium-grid">
    <% products.forEach((product)=> { %>
    <div class="product-card">
      <a href="/viewProduct/?id=<%= product._id %>" class="image-container">
        <% if (product.quantity < 6 && product.quantity > 0 ) { %>
        <span class="status-badge">Limited Stock</span>
        <% } else if (product.quantity < 1) { %>
        <span class="status-badge" style="background: #e74c3c">Sold Out</span>
        <% } %>
        <img src="productImages/<%= product.images[0] %>" alt="<%= product.name %>" />
      </a>

      <div class="card-info">
        <p class="brand-name"><%= product.company %></p>
        <h5 class="product-name"><%= product.name.length > 35 ? product.name.slice(0, 32) + '...' : product.name %></h5>

        <% let today = new Date() %>
        <div class="price-wrap">
          <% if((product.product_OfferDetails && product.product_OfferDetails.offerStartDate <= today && product.product_OfferDetails.offerEndDate >= today) ||
          (product.category_OfferDetails && product.category_OfferDetails.offerStartDate <= today && product.category_OfferDetails.offerEndDate >= today)) {
          const offer = product.product_OfferDetails || product.category_OfferDetails; const discountAmount = (product.price * offer.discountPercentage) / 100;
          const finalPrice = product.price - discountAmount; %>
          <span class="old-price">₹<%= product.price %></span>
          <span class="discount-label"><%= offer.discountPercentage %>% OFF</span>
          <p class="price-tag">₹<%= finalPrice.toFixed(2) %></p>
          <% } else { %>
          <p class="price-tag">₹<%= product.price %>.00</p>
          <% } %>
        </div>

        <div class="action-row">
          <% if (product.quantity > 0) { %>
          <a href="/addToCart/?id=<%= product._id %>" class="add-cart-btn">ADD TO BAG</a>

          <% let inWishlist = whishlist.some(Wp => Wp.product_id == product._id) %> <% if(inWishlist) { %>
          <a href="/RemovePdtFrmWhishlist/<%= product._id %>/home"><i class="fa-solid fa-heart text-danger fs-4"></i></a>
          <% } else { %>
          <a href="/addToWhishlist/?id=<%= product._id %>&from=home"><i class="fa-regular fa-heart text-secondary fs-4"></i></a>
          <% } %> <% } else { %>
          <span class="text-danger fw-bold small uppercase">Currently Unavailable</span>
          <% } %>
        </div>
      </div>
    </div>
    <% }) %>
  </div>

  <div class="category-container">
    <div class="category-box">
      <img src="https://images.pexels.com/photos/267301/pexels-photo-267301.jpeg?auto=compress&cs=tinysrgb&dpr=1&w=500" alt="Male" />
      <div style="position: absolute; bottom: 40px; left: 40px; color: white; font-weight: 600">
        <h3 class="fw-bold uppercase">Men's Collection</h3>
      </div>
    </div>
    <div class="category-box">
      <img
        src="https://media.istockphoto.com/id/846681586/photo/high-heel-boots.jpg?s=612x612&w=0&k=20&c=0JVYDAhUsvTfaCQBZAGwF11QdWw68H506ZHU8SyIdH4="
        alt="Female"
      />
      <div style="position: absolute; bottom: 40px; left: 40px; color: white; font-weight: 600">
        <h3 class="fw-bold uppercase">Women's Collection</h3>
      </div>
    </div>
  </div>

  <div class="section-title-wrap">
    <h4>Best Sellers</h4>
    <a href="/viewAllBestProducts" class="view-all-link">EXPLORE ALL</a>
  </div>

  <div class="premium-grid">
    <% topProducts.forEach((product)=> { %>
    <div class="product-card">
      <a href="/viewProduct/?id=<%= product._id %>" class="image-container">
        <img src="productImages/<%= product.images[0] %>" alt="" />
      </a>
      <div class="card-info">
        <p class="brand-name"><%= product.company %></p>
        <h5 class="product-name"><%= product.name %></h5>
        <p class="price-tag">₹<%= product.price %>.00</p>
        <div class="action-row">
          <a href="/addToCart/?id=<%= product._id %>" class="add-cart-btn">ADD TO BAG</a>
        </div>
      </div>
    </div>
    <% }) %>
  </div>

  <% if(ThankBanner) { %>
  <a href="<%= ThankBanner.url %>" style="display: block; margin: 60px 0">
    <img src="/banners/<%= ThankBanner.image %>" style="width: 100%; border-radius: 20px; height: 60vh; object-fit: cover" />
  </a>
  <% } %>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<%- include('../layouts/footer.ejs') %>

<script>
  $(document).ready(function () {
    $(".banner-carousel").owlCarousel({
      loop: true,
      margin: 20,
      nav: true,
      autoplay: true,
      autoplayTimeout: 4000,
      items: 1,
      animateOut: "fadeOut",
      navText: ["<i class='fa fa-chevron-left'></i>", "<i class='fa fa-chevron-right'></i>"],
    });
  });
</script>
