<%- include('../layouts/header.ejs') %>
<link rel="stylesheet" href="/css/userCss/userProffile.css" />  

<link rel="stylesheet" href="/css/userCss/editAdd.css">


<div class="profile-wrapper">
  <aside class="profile-sidebar">
    <div class="user-greeting">
      <img src="/userProfileImages/user (1).png" alt="User" />
      <div>
        <small class="text-muted">Hello,</small>
        <h2><%= user.name %></h2>
      </div>
    </div>

    <nav class="nav-menu">
      <a href="/profile" class="nav-item-link"> <i class="fa-solid fa-gauge"></i> Account Overview </a>
      <a href="/myOrders" class="nav-item-link"> <i class="fa-solid fa-box"></i> My Orders </a>
      <a href="/manageAddress" class="nav-item-link active"> <i class="fa-solid fa-map-location-dot"></i> Manage Addresses </a>
      <a href="/whishlist" class="nav-item-link"> <i class="fa-solid fa-heart"></i> My Wishlist </a>
      <a href="/wallet" class="nav-item-link"> <i class="fa-solid fa-wallet"></i> Wallet </a>
      <a href="/logout" class="nav-item-link text-danger"> <i class="fa-solid fa-right-from-bracket"></i> Logout </a>
    </nav>
  </aside>

  <main class="profile-content">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h3 class="fw-bold m-0">Manage Address</h3>
    </div>

    <main class="profile-content" style="border: none">
      <a href="/manageAddress" class="d-flex align-items-center mb-4" style="display: flex; align-items: center; gap: 8px">
        <i class="fa-solid fa-arrow-left"></i>
        <h3 class="fw-bold m-0">Edit Address</h3>
      </a>

      <div class="form-card-premium">
        <form action="/EditAddress/<%= address._id %>" method="post" class="modern-form">
          <div class="row g-4">
            <div class="col-md-4">
              <div class="input-group-custom">
                <label><i class="fa-solid fa-globe me-2"></i>Country</label>
                <select id="country" name="country" class="form-select-custom">
                  <option value="<%= address.country %>" selected><%= address.country %></option>
                </select>
              </div>
            </div>

            <div class="col-md-4">
              <div class="input-group-custom">
                <label><i class="fa-solid fa-map me-2"></i>State</label>
                <select id="state" name="state" class="form-select-custom">
                  <option value="<%= address.state %>" selected><%= address.state %></option>
                </select>
              </div>
            </div>

            <div class="col-md-4">
              <div class="input-group-custom">
                <label><i class="fa-solid fa-location-crosshairs me-2"></i>District</label>
                <select id="district" name="district" class="form-select-custom">
                  <option value="<%= address.district %>" selected><%= address.district %></option>
                </select>
              </div>
            </div>

            <div class="col-md-6">
              <div class="input-group-custom">
                <label>City / Town</label>
                <input type="text" name="city" value="<%= address.city %>" class="form-control-custom" placeholder="e.g. New York" />
              </div>
            </div>

            <div class="col-md-6">
              <div class="input-group-custom">
                <label>Pincode</label>
                <input type="number" name="pincode" value="<%= address.pincode %>" class="form-control-custom" placeholder="6-digit code" />
              </div>
            </div>

            <div class="col-12">
              <div class="input-group-custom">
                <label>Street / Area Name</label>
                <input type="text" name="street" value="<%= address.street %>" class="form-control-custom" placeholder="Apartment, suite, unit, etc." />
              </div>
            </div>

            <div class="col-12">
              <div class="input-group-custom">
                <label>House Number / Name</label>
                <input type="text" name="houseNo" value="<%= address.houseNo %>" class="form-control-custom" placeholder="Building name or number" />
              </div>
            </div>

            <div class="col-12 mt-5">
              <hr class="opacity-10" />
              <div class="d-flex gap-3">
                <button type="submit" class="btn btn-dark btn-lg px-5">Save Changes</button>
                <a href="/manageAddress" class="btn btn-outline-secondary btn-lg px-5">Cancel</a>
              </div>
            </div>
          </div>
        </form>
      </div>
    </main>
  </main>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>
  function confirmDelete(event, productId) {
    event.preventDefault();
    Swal.fire({
      title: "Are you sure?",
      text: "You want to cancel this order!",
      icon: "warning",
      showCancelButton: true,
      confirmButtonColor: "#000",
      cancelButtonColor: "#d33",
      confirmButtonText: "Yes, cancel it!",
    }).then((result) => {
      if (result.isConfirmed) {
        window.location.href = "/cancelOrder/" + productId;
      }
    });
  }

  $(document).ready(function () {
    $(".retry-payment").click(function () {
      var orderId = $(this).data("order-id");
      $.ajax({
        url: "/confirmRetryOrder",
        method: "POST",
        data: { id: orderId },
        success: function (res) {
          if (res.success) {
            var options = {
              key: res.key_id,
              amount: res.amount,
              currency: "INR",
              name: "Dash Footwares",
              order_id: res.order_id,
              handler: function (response) {
                window.location.href = "/updateOrderInDb/?id=" + orderId;
              },
              theme: { color: "#000000" },
            };
            var rzp = new Razorpay(options);
            rzp.open();
          } else {
            alert(res.msg);
          }
        },
      });
    });
  });
</script>

<%- include('../layouts/footer.ejs') %>
