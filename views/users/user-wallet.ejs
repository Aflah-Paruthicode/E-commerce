<%- include('../layouts/header.ejs') %>
<link rel="stylesheet" href="/css/userCss/userProffile.css" />
<link rel="stylesheet" href="/css/userCss/wallet.css">

<div class="profile-wrapper">
  <aside class="profile-sidebar">
    <div class="user-greeting">
      <img src="/userProfileImages/user (1).png" alt="User" />
      <div>
        <small class="text-muted">Hello,</small>
        <h2><%= user.name %></h2>
      </div>
    </div>

    <nav class="nav-menu">
      <a href="/profile" class="nav-item-link"> <i class="fa-solid fa-gauge"></i> Account Overview </a>
      <a href="/myOrders" class="nav-item-link"> <i class="fa-solid fa-box"></i> My Orders </a>
      <a href="/manageAddress" class="nav-item-link"> <i class="fa-solid fa-map-location-dot"></i> Manage Addresses </a>
      <a href="/whishlist" class="nav-item-link"> <i class="fa-solid fa-heart"></i> My Wishlist </a>
      <a href="/wallet" class="nav-item-link  active "> <i class="fa-solid fa-wallet"></i> Wallet </a>
      <a href="/logout" class="nav-item-link text-danger"> <i class="fa-solid fa-right-from-bracket"></i> Logout </a>
    </nav>
  </aside>  
  
      <main class="profile-content">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="fw-bold m-0">My Wallet</h3>
    </div>

    <div class="wallet-balance-card mb-5">
        <div class="card-pattern"></div>
        <div class="balance-info">
            <p class="balance-label">Available Balance</p>
            <h1 class="balance-amount">₹<%= wallet.Money %><span class="decimal">.00</span></h1>
        </div>
        <div class="wallet-chip">
            <i class="fa-solid fa-microchip"></i>
        </div>
        <div class="wallet-footer">
            <p class="user-card-name"><%= user.name.toUpperCase() %></p>
            <img src="/logo/DashFootwares.png" alt="Logo" width="40" style="filter: invert(1); border-radius: 8px;">
        </div>
    </div>

    <div class="transaction-section">
        <h5 class="fw-bold mb-4">Transaction History</h5>
        
        <div class="transaction-container">
            <% if (walletHistory.length === 0) { %>
                <div class="text-center py-5">
                    <i class="fa-solid fa-receipt fs-1 opacity-25 mb-3"></i>
                    <p class="text-muted">No transactions found.</p>
                </div>
            <% } %>

            <% walletHistory.forEach((transaction, index) => { %>
                <div class="transaction-item">
                    <div class="trans-icon <%= transaction.type === true ? 'type-debit' : 'type-credit' %>">
                        <i class="fa-solid <%= transaction.type === true ? 'fa-arrow-up' : 'fa-arrow-down' %>"></i>
                    </div>
                    
                    <div class="trans-details">
                        <p class="trans-name"><%= transaction.product_name %></p>
                        <p class="trans-meta">
                            Qty: <%= transaction.quantity %> • <%= transaction.paymentMethod %>
                        </p>
                    </div>

                    <div class="trans-status text-end">
                        <p class="trans-amount <%= transaction.type === true ? 'text-danger' : 'text-success' %>">
                            <%= transaction.type === true ? '-' : '+' %>₹<%= transaction.money %>
                        </p>
                        <span class="status-pill <%= transaction.type === true ? 'pill-danger' : 'pill-success' %>">
                            <%= transaction.type === true ? 'Order Placed' : 'Order Cancelled' %>
                        </span>
                    </div>
                </div>
            <% }) %>
        </div>
    </div>

    <% if (pagination.totalPages > 1) { %>
        <nav class="mt-4">
            <ul class="pagination pagination-modern justify-content-center">
                <% for (let j = 1; j <= pagination.totalPages; j++) { %>
                    <li class="page-item <%= pagination.currentPage === j ? 'active' : '' %>">
                        <a class="page-link" href="?page=<%= j %>"><%= j %></a>
                    </li>
                <% } %>
            </ul>
        </nav>
    <% } %>
</main>
    </div>

    <%- include('../layouts/footer.ejs') %>
  </body>
</html>
