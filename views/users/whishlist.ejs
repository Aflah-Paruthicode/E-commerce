<%- include('../layouts/header.ejs') %>
<link rel="stylesheet" href="/css/userCss/wishlist.css" />

<div class="wishlist-hero">
  <div class="container">
    <h2>Your Favorites</h2>
    <p class="text-muted">Items you've saved to your collection</p>
  </div>
</div>

<div class="wishlist-container">
  <% if (whishlist && whishlist.length > 0) { %>
  <table class="wishlist-table">
    <thead>
      <tr>
        <th>Product Details</th>
        <th>Unit Price</th>
        <th>Stock Status</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      <% whishlist.forEach((item, index) => { %>
      <tr class="wishlist-row">
        <td>
          <div class="product-info">
            <a href="#" class="btn-delete-item" onclick="confirmDelete(event, '<%= item._id %>');">
              <i class="fa-solid fa-xmark"></i>
            </a>
            <img class="pdt-img" src="productImages/<%= item.images[0] %>" alt="<%= item.name %>" />
            <div>
              <a href="/viewProduct/?id=<%= item._id %>" class="pdt-name"><%= item.name %></a>
              <span class="added-date">Added on: <%= wishes[index].added_on %></span>
            </div>
          </div>
        </td>
        <td>
          <span class="price-text">â‚¹<%= item.price %>.00</span>
        </td>
        <td>
          <% if(item.quantity > 0) { %>
          <span class="status-badge status-in">In Stock</span>
          <% } else { %>
          <span class="status-badge status-out">Out of Stock</span>
          <% } %>
        </td>
        <td>
          <% if(item.quantity > 0) { %>
          <a class="btn-cart-sm" href="/addToCart/?id=<%= item._id %>&from=whishlist"> <i class="fa-solid fa-cart-shopping me-2"></i> Add to Cart </a>
          <% } else { %>
          <span class="text-danger fw-bold" style="font-size: 13px">Currently Unavailable</span>
          <% } %>
        </td>
      </tr>
      <% }) %>
    </tbody>
  </table>
  <% } else { %>
  <div class="empty-wishlist">
    <i class="fa-regular fa-heart mb-4" style="font-size: 60px; color: #ddd"></i>
    <h3>Your wishlist is empty</h3>
    <p class="text-muted">Start adding items you love to keep track of them!</p>
    <a href="/" class="btn btn-dark mt-3 px-5 py-3" style="border-radius: 50px">Go to Shop</a>
  </div>
  <% } %>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
  function confirmDelete(event, productId) {
    event.preventDefault();

    Swal.fire({
      title: "Remove from Wishlist?",
      text: "This item will be removed from your saved collection.",
      icon: "warning",
      showCancelButton: true,
      confirmButtonColor: "#1a1a1a",
      cancelButtonColor: "#d33",
      confirmButtonText: "Yes, remove it!",
      cancelButtonText: "Keep it",
      background: "#fff",
      color: "#1a1a1a",
    }).then((result) => {
      if (result.isConfirmed) {
        window.location.href = "/RemovePdtFrmWhishlist/" + productId + "/false";
      }
    });
  }
</script>
